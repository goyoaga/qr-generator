<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de C√≥digo QR</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- QRious Library for QR Code Generation -->
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

    <style>
        @import url('https://fonts.fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2ff; /* Indigo 50 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // Inicializamos con el link de GitHub actualizado
            const [url, setUrl] = useState('https://github.com/goyoaga');
            const [size, setSize] = useState(256);
            const [qrDataUrl, setQrDataUrl] = useState('');
            const canvasRef = useRef(null);
            const [message, setMessage] = useState('');

            // Genera el c√≥digo QR cada vez que la URL o el tama√±o cambian
            useEffect(() => {
                if (window.QRious) {
                    try {
                        // Crear la instancia de QRious, que dibuja en un canvas
                        const qr = new QRious({
                            element: canvasRef.current,
                            value: url,
                            size: size,
                            padding: 20,
                            level: 'H' // Alto nivel de correcci√≥n de errores
                        });
                        
                        // Obtener la URL de datos de la imagen PNG para la descarga
                        setQrDataUrl(qr.toDataURL('image/png'));
                        setMessage(''); // Limpiar cualquier mensaje de error
                    } catch (error) {
                        console.error("Error generating QR:", error);
                        setMessage('Error al generar el QR. Intenta con una URL diferente.');
                    }
                }
                 if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [url, size]);
            
            // Re-inicializar iconos Lucide
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });


            // Funci√≥n para iniciar la descarga del archivo PNG
            const handleDownload = () => {
                if (!qrDataUrl) {
                    setMessage('No hay QR para descargar. Ingresa una URL.');
                    return;
                }
                const link = document.createElement('a');
                link.href = qrDataUrl;
                link.download = `QR_${new Date().getTime()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setMessage('¬°QR descargado exitosamente!');
                setTimeout(() => setMessage(''), 3000);
            };

            return (
                <div className="w-full max-w-2xl bg-white p-6 sm:p-8 rounded-3xl shadow-2xl border border-indigo-100 transition-all duration-500">
                    
                    <div className="flex items-center gap-3 mb-6 border-b pb-4">
                        <i data-lucide="qrcode" className="text-indigo-600 w-8 h-8"></i>
                        {/* T√≠tulo principal con emoji de rayo */}
                        <h1 className="text-3xl font-bold text-gray-900">Generador de C√≥digo QR ‚ö°</h1>
                    </div>
                    <p className="text-gray-500 mb-8">Escribe o pega tu enlace para generar un c√≥digo QR funcional y descargable.</p>

                    {/* Input de URL */}
                    <div className="mb-6">
                        <label htmlFor="url-input" className="block text-sm font-semibold text-gray-700 mb-2">
                            Direcci√≥n URL (enlace completo)
                        </label>
                        <input
                            id="url-input"
                            type="url"
                            value={url}
                            onChange={(e) => setUrl(e.target.value)}
                            placeholder="Ejemplo: https://github.com/goyoaga"
                            className="w-full p-3 rounded-xl border-2 border-gray-200 focus:border-indigo-500 transition-all outline-none bg-gray-50 text-base"
                        />
                    </div>
                    
                    {/* Controles de Tama√±o */}
                    <div className="mb-8">
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                            Tama√±o del QR: {size}x{size} px
                        </label>
                        <input
                            type="range"
                            min="128"
                            max="512"
                            step="64"
                            value={size}
                            onChange={(e) => setSize(parseInt(e.target.value))}
                            className="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer range-lg"
                        />
                    </div>

                    <div className="flex flex-col md:flex-row items-center justify-between gap-6">
                        
                        {/* √Årea de Visualizaci√≥n del QR (Canvas) */}
                        <div className="flex-shrink-0 p-4 border-4 border-indigo-100 bg-white rounded-xl shadow-inner transition-all duration-300">
                            <canvas ref={canvasRef} width={size} height={size} className="rounded-lg"></canvas>
                        </div>
                        
                        {/* Bot√≥n de Descarga */}
                        <div className="flex-grow w-full md:w-auto">
                            <button
                                onClick={handleDownload}
                                disabled={!url}
                                className="w-full flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-all duration-300 active:scale-[0.98] disabled:bg-indigo-300 disabled:cursor-not-allowed"
                            >
                                <i data-lucide="download" className="w-5 h-5"></i>
                                Descargar QR (PNG)
                            </button>
                            
                            {/* Mensaje de estado (Toast) */}
                            {message && (
                                <div className="mt-4 p-3 text-sm font-medium text-center text-indigo-800 bg-indigo-50 border border-indigo-200 rounded-lg shadow-md">
                                    {message}
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-8 pt-4 border-t border-gray-100 text-center">
                        <p className="text-xs text-gray-400 mb-1">Generado en tiempo real en el navegador, ¬°100% funcional!</p>
                        {/* Pie de p√°gina actualizado con robot y autor√≠a */}
                        <p className="text-xs text-gray-500 font-medium">Licencia: MIT (Gratuita) | por Ariel Goyoaga ü§ñ</p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
